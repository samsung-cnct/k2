---
- name: Set Cluster Fact
  set_fact:
    cluster: "{{ a_cluster }}"

- name: Make sure generated folder for full cloud configs is there
  file:
    path: "{{ config_base | expanduser }}/{{ cluster.name }}/cloud-config"
    state: directory

- name: Generate node cloud init
  copy:
    dest: "{{ config_base | expanduser }}/{{ cluster.name }}/cloud-config/{{ item.name }}.cloud-config.yaml"
    content: "{{ cloud_config[cluster.name][item.name] | to_nice_yaml(indent=2) }}"
  with_items:
    - "{{ cluster.nodePools }}"
